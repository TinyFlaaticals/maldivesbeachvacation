<div class="flex flex-col lg:flex-row gap-8 mt-4 mx-4">
    <!-- Filter Sidebar -->
    <div class="w-full lg:w-64 lg:flex-shrink-0" data-controller="filter">
        <!-- Mobile Filter Toggle -->
        <div class="lg:hidden mb-4">
            <button data-action="click->filter#toggleFilters" class="w-full py-2 px-4 bg-white rounded-lg shadow text-gray-700 flex items-center justify-between">
                <span class="font-medium">Filters</span>
                <svg xmlns="http://www.w3.org/2000/svg" class="h-5 w-5" fill="none" viewBox="0 0 24 24" stroke="currentColor" data-filter-target="toggleIcon">
                    <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M19 9l-7 7-7-7" />
                </svg>
            </button>
        </div>

        <!-- Filter Content -->
        <div class="bg-white p-4 rounded-lg shadow hidden lg:block" data-filter-target="filterContent">
            <div class="flex justify-between items-center mb-4">
                <h3 class="font-medium text-lg">Filters</h3>
                <%= link_to "Clear", properties_path, class: "text-sm text-gray-600" %>
            </div>
            <div class="space-y-6">
                <div>
                    <h4 class="font-medium mb-2">Offers & Discounts</h4>
                    <div class="space-y-2">
                        <%= check_box_tag :with_offer, "true", checked: @filtered_with_offer == "true", class: "mr-2", data: { action: "change->filter#submit" } %>
                        <%= label_tag :with_offer_true, "With Offer", class: "text-sm text-gray-600" %>
                        <br>
                        <%= check_box_tag :with_discount, "true", checked: @filtered_with_discount == "true", class: "mr-2", data: { action: "change->filter#submit" } %>
                        <%= label_tag :with_discount_true, "With Discount", class: "text-sm text-gray-600" %>
                    </div>
                </div>
                <!-- Price Range -->
                <div>
                    <h4 class="font-medium mb-2">Price Range</h4>
                    <div class="space-y-2">
                        <div class="flex items-center">
                            <%= radio_button_tag :price_range, "all", checked: @filtered_min_price.blank? && @filtered_max_price.blank?, class: "mr-2", data: { action: "change->filter#setPriceRange" } %>
                            <%= label_tag :price_range_all, "All", class: "text-sm text-gray-600" %>
                        </div>
                        <div class="flex items-center">
                            <%= radio_button_tag :price_range, "0-200", checked: @filtered_min_price == "0" && @filtered_max_price == "200", class: "mr-2", data: { action: "change->filter#setPriceRange" } %>
                            <%= label_tag :price_range_0_200, "$0-$200", class: "text-sm text-gray-600" %>
                        </div>
                        <div class="flex items-center">
                            <%= radio_button_tag :price_range, "200-500", checked: @filtered_min_price == "200" && @filtered_max_price == "500", class: "mr-2", data: { action: "change->filter#setPriceRange" } %>
                            <%= label_tag :price_range_200_500, "$200-$500", class: "text-sm text-gray-600" %>
                        </div>
                        <div class="flex items-center">
                            <%= radio_button_tag :price_range, "500-1000", checked: @filtered_min_price == "500" && @filtered_max_price == "1000", class: "mr-2", data: { action: "change->filter#setPriceRange" } %>
                            <%= label_tag :price_range_500_1000, "$500-$1,000", class: "text-sm text-gray-600" %>
                        </div>
                        <div class="flex items-center">
                            <%= radio_button_tag :price_range, "1000-2000", checked: @filtered_min_price == "1000" && @filtered_max_price == "2000", class: "mr-2", data: { action: "change->filter#setPriceRange" } %>
                            <%= label_tag :price_range_1000_2000, "$1,000-$2,000", class: "text-sm text-gray-600" %>
                        </div>
                        <div class="flex items-center">
                            <%= radio_button_tag :price_range, "2000-5000", checked: @filtered_min_price == "2000" && @filtered_max_price == "5000", class: "mr-2", data: { action: "change->filter#setPriceRange" } %>
                            <%= label_tag :price_range_2000_5000, "$2,000-$5,000", class: "text-sm text-gray-600" %>
                        </div>
                    </div>
                    <div class="flex gap-2 mt-2">
                        <div class="w-full relative">
                            <span class="absolute left-3 top-1/2 transform -translate-y-1/2 text-gray-500">$</span>
                            <%= number_field_tag :min_price, params[:min_price], placeholder: "0", class: "w-full rounded border-gray-300 text-gray-600 pl-6 [appearance:textfield] [&::-webkit-outer-spin-button]:appearance-none [&::-webkit-inner-spin-button]:appearance-none", 
                  data: { action: "change->filter#submit" }, maxlength: 5 %>
                        </div>
                        <div class="flex items-center justify-center">
                            <span class="text-gray-400">-</span>
                        </div>
                        <div class="w-full relative">
                            <span class="absolute left-3 top-1/2 transform -translate-y-1/2 text-gray-500">$</span>
                            <%= number_field_tag :max_price, params[:max_price], placeholder: "99999", class: "w-full rounded border-gray-300 text-gray-600 pl-6 [appearance:textfield] [&::-webkit-outer-spin-button]:appearance-none [&::-webkit-inner-spin-button]:appearance-none",
                  data: { action: "change->filter#submit" }, maxlength: 5 %>
                        </div>
                    </div>
                </div>
                <!-- Facilities -->
                <div>
                    <h4 class="font-medium mb-2">Facilities</h4>
                    <div class="space-y-2">
                        <%= collection_check_boxes :filter, :facilities, Facility.all, :id, :name do |b| %>
                        <div class="flex items-center">
                            <%= b.check_box(class: "rounded border-gray-300", data: { action: "change->filter#submit" }, checked: @filtered_facilities&.include?(b.value.to_s)) %>
                            <%= b.label(class: "ml-2 text-sm text-gray-600") %>
                        </div>
                        <% end %>
                    </div>
                </div>
                <!-- Activities -->
                <div>
                    <h4 class="font-medium mb-2">Activities</h4>
                    <div class="space-y-2">
                        <%= collection_check_boxes :filter, :activities, Activity.all, :id, :name do |b| %>
                        <div class="flex items-center">
                            <%= b.check_box(class: "rounded border-gray-300", data: { action: "change->filter#submit" }, checked: @filtered_activities&.include?(b.value.to_s)) %>
                            <%= b.label(class: "ml-2 text-sm text-gray-600") %>
                        </div>
                        <% end %>
                    </div>
                </div>
                <!-- Popular Filters -->
                <div>
                    <h4 class="font-medium mb-2">Popular Filters</h4>
                    <div class="space-y-2">
                        <%= collection_check_boxes :filter, :popular_filters, PopularFilter.all, :id, :name do |b| %>
                        <div class="flex items-center">
                            <%= b.check_box(class: "rounded border-gray-300", data: { action: "change->filter#submit" }, checked: @filtered_popular_filters&.include?(b.value.to_s)) %>
                            <%= b.label(class: "ml-2 text-sm text-gray-600") %>
                        </div>
                        <% end %>
                    </div>
                </div>
            </div>
        </div>
    </div>
    <!-- Properties List -->
    <div class="flex-1">
        <div class="mb-4">
            <p class="text-gray-600">
                <span class="font-medium text-gray-800"><%= @properties.group(:id).count.size %></span>
                <%= 'property'.pluralize(@properties.group(:id).count.size) %> found
            </p>
        </div>
        <div class="flex flex-col gap-4">
            <% @properties.each do |property| %>
            <%= render "property", property: property %>
            <% end %>
        </div>
    </div>
</div>